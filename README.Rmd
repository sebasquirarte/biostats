---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
```{r setup, include=FALSE}
# Set global seed for reproducibility
set.seed(100)
```

# biostats <a href="https://github.com/sebasquirarte/biostats/blob/main/man/figures/logo.png"><img src="man/figures/logo.png" align="right" height="138" alt="biostats_logo" /></a>

<!-- badges: start -->
[![R-CMD-check.yaml](https://github.com/sebasquirarte/biostats/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/sebasquirarte/biostats/actions/workflows/R-CMD-check.yaml)
[![Tests](https://github.com/sebasquirarte/biostats/actions/workflows/test-coverage.yaml/badge.svg)](https://github.com/sebasquirarte/biostats/actions/workflows/test-coverage.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/biostats)](https://cran.r-project.org/package=biostats)
[![Codecov test coverage](https://codecov.io/gh/sebasquirarte/biostats/graph/badge.svg?token=ba2a281e-60be-4036-a40c-a3afaadee1ed)](https://app.codecov.io/gh/sebasquirarte/biostats)
<!-- badges: end -->

## Overview

_**biostats**_ is a toolbox for biostatistics and clinical data analysis in R.

#### Key features
- Summary statistics
- Exploratory data analysis (EDA)
- Sample size and power calculation
- Statistical tests
- Data cleaning, transformation, and visualization

*Developed by the biostatistics team at [Laboratorios Sophia S.A. de C.V.](https://sophialab.com/) for biostatisticians, clinical researchers and data analysts.*

## Installation

```{r echo=FALSE}
# Set CRAN mirror first
options(repos = c(CRAN = "https://cran.rstudio.com/"))
```

```{r installation, warning=FALSE, message=FALSE, results='hide'}
install.packages("remotes") 
library(remotes)
remotes::install_github('sebasquirarte/biostats',
                        auth_token = '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',
                        upgrade = FALSE)
library(biostats)
```

## Usage

The biostats toolbox includes the following exported functions.

- [**Summary Statistics and Exploratory Data Analysis (EDA)**](#summary-and-exploratory-data-analysis-eda)
  - [clinical_data()](#clinical_data) ✔️
  - [summary_table()](#summary_table) ✔️
  - [normality()](#normality) 
  - [missing_values()](#missing_values) 
- [**Sample Size and Power Calculation**](#sample-size-and-power-calculation)
  - [sample_size()](#sample_size)
  - [sample_size_table()](#sample_size_table)
  - [stat_power()](#stat_power)
- [**Statistical Tests**](#statistical-tests)
  - [odds()](#odds) 
  - [anova_test()](#anova_test) 
  - [hypothesis_test()](#hypothesis_test)
- [**Data Cleaning and Transformation**](#data-cleaning-and-transformation)
  - [outliers()](#outliers) 
  - [from_baseline()](#from_baseline)
  - [auc()](#auc)
  - [impute()](#impute)
  - [pivot_data()](#pivot_data) 
- [**Data Visualization**](#data-visualization)
  - [plot_bar()](#plot_bar)
  - [plot_hist()](#plot_hist)
  - [plot_box()](#plot_box)
  - [plot_line()](#plot_line)
  - [plot_waterfall()](#plot_waterfall)
  - [plot_spider()](#plot_spider)
  - [plot_sankey()](#plot_sankey)
  - [plot_butterfly()](#plot_butterfly)
  - [plot_auc()](#plot_auc)
  - [plot_corrrelation()](#plot_correlation)

### Summary and Exploratory Data Analysis (EDA)

#### **clinical_data()**

##### Description

Creates a dataset of simulated clinical trial data with subject demographics, multiple visits, treatment groups, numerical and categorical variables, as well as optional missing data and dropout rates.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `n` | Number of subjects (1-999) | 100 |
| `visits` | Number of visits including baseline | 3 |
| `arms` | Character vector of treatment arms | `c('Placebo', 'Treatment')` |
| `dropout_rate` | Proportion of subjects who dropout (0-1) | 0 |
| `na_rate` | Proportion of missing data at random (0-1) | 0 |

##### Examples

```{r}
# Basic dataset
clinical_df <- clinical_data()

head(clinical_df)

tail(clinical_df)
```
```{r}
# Multiple treatment arms with dropout rate and missing data
clinical_df <- clinical_data(arms = c('Placebo', 'A', 'B'), na_rate = 0.05, dropout_rate = 0.10)

head(clinical_df, 10)

tail(clinical_df, 10)
```

#### **summary_table()**

##### Description

Generates summary tables for biostatistics and clinical data analysis with automatic statistical test selection and effect size calculations. Handles both numeric and categorical variables, performing appropriate descriptive statistics and inferential tests for single-group summaries or two-group comparisons.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `data` | A data frame containing the variables to be summarized | `Required` |
| `group_var` | Name of the grouping variable for two-group comparisons | `NULL` |
| `all_stats` | Logical; if TRUE, provides detailed statistical summary | `FALSE` |
| `effect_size` | Logical; if TRUE, includes effect size estimates | `FALSE` |
| `exclude` | Character vector; variable names to exclude from the summary | `NULL` |

##### Examples

```{r}
clinical_df <- clinical_data()

# General summary without considering treatment groups
clinical_summary <- summary_table(clinical_df,
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```
    
```{r}
# Grouped summary for each tratment group
clinical_summary <- summary_table(clinical_df,
                                  group_var = 'treatment',
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```
    
```{r}
# Grouped summary for each tratment group with all stats
clinical_summary <- summary_table(clinical_df,
                                  group_var = 'treatment',
                                  all_stats = TRUE,
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```
    
```{r}
# Grouped summary for each tratment group with effect size
clinical_summary <- summary_table(clinical_df,
                                  group_var = 'treatment',
                                  effect_size = TRUE,
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```

#### **normality()**

##### Description

Tests normality with statistical tests and visual assessment using QQ plot and histogram.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `x` | A numeric vector or the name of a variable in a data frame | `Required` |
| `data` | Optional data frame containing the variable | `NULL` |
| `outliers` | Logical; whether to print all outlier row numbers | `FALSE` |
| `color` | Character; color for points and histogram bars | `"#7fcdbb"` |

##### Examples

```{r, fig.width=10, fig.height=5, dpi=300, out.width="100%"}
# Normal data
normality('biomarker',
          data = clinical_df)
```

```{r, fig.width=10, fig.height=5, dpi=300, out.width="100%"}
# Skewed data (show rows of outliers)
normality('weight',
          data = clinical_df,
          outliers = TRUE)
```
