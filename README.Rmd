---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
```{r setup, include=FALSE}
# Set global seed for reproducibility
set.seed(100)
```

# biostats <a href="https://github.com/sebasquirarte/biostats/blob/main/man/figures/logo.png"><img src="man/figures/logo.png" align="right" height="138" alt="biostats_logo" /></a>

<!-- badges: start -->
[![R-CMD-check.yaml](https://github.com/sebasquirarte/biostats_CRAN/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/sebasquirarte/biostats_CRAN/actions/workflows/R-CMD-check.yaml)
[![Tests](https://github.com/sebasquirarte/biostats_CRAN/actions/workflows/test-coverage.yaml/badge.svg)](https://github.com/sebasquirarte/biostats_CRAN/actions/workflows/test-coverage.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/biostats)](https://cran.r-project.org/package=biostats)
[![Codecov test coverage](https://codecov.io/gh/sebasquirarte/biostats_CRAN/graph/badge.svg?token=ba2a281e-60be-4036-a40c-a3afaadee1ed)](https://app.codecov.io/gh/sebasquirarte/biostats_CRAN)
<!-- badges: end -->

## Overview

_**biostats**_ is a versatile R toolbox that aids in biostatistics and clinical data analysis workflows.

#### Key features
- Summary statistics
- Exploratory data analysis (EDA)
- Sample size and power calculation
- Statistical tests
- Data cleaning, transformation, and visualization

*Developed by the biostatistics team at [Laboratorios Sophia S.A. de C.V.](https://sophialab.com/) for biostatisticians, clinical researchers and data analysts.*

## Installation

```{r echo=FALSE}
# Set CRAN mirror first
options(repos = c(CRAN = "https://cran.rstudio.com/"))
```

```{r installation, warning=FALSE, message=FALSE, results='hide'}
install.packages("remotes") 
library(remotes)
remotes::install_github("sebasquirarte/biostats",
                        auth_token = "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",
                        upgrade = FALSE)
library(biostats)
```

## Usage

The biostats toolbox includes the following 25 exported functions.

- [**Summary Statistics and Exploratory Data Analysis (EDA)**](#summary-and-exploratory-data-analysis-eda)
  - [clinical_data()](#clinical_data) ✔
  - [summary_table()](#summary_table) ✔
  - [normality()](#normality) ✔
  - [missing_values()](#missing_values) ✔
- [**Sample Size and Power Calculation**](#sample-size-and-power-calculation)
  - [sample_size()](#sample_size)
  - [sample_size_table()](#sample_size_table)
  - [stat_power()](#stat_power)
- [**Statistical Tests**](#statistical-tests)
  - [odds()](#odds) ✔
  - [anova_test()](#anova_test) ✔
  - [hypothesis_test()](#hypothesis_test)
- [**Data Cleaning and Transformation**](#data-cleaning-and-transformation)
  - [outliers()](#outliers) ✔
  - [from_baseline()](#from_baseline)
  - [auc()](#auc)
  - [impute()](#impute)
  - [pivot_data()](#pivot_data) ✔
- [**Data Visualization**](#data-visualization)
  - [plot_bar()](#plot_bar)
  - [plot_hist()](#plot_hist)
  - [plot_box()](#plot_box)
  - [plot_line()](#plot_line)
  - [plot_waterfall()](#plot_waterfall)
  - [plot_spider()](#plot_spider)
  - [plot_sankey()](#plot_sankey)
  - [plot_butterfly()](#plot_butterfly)
  - [plot_auc()](#plot_auc)
  - [plot_corrrelation()](#plot_correlation)

### Summary and Exploratory Data Analysis (EDA)

#### **clinical_data()**

##### Description

Creates a dataset of simulated clinical trial data with subject demographics, multiple visits, treatment groups, numerical and categorical variables, as well as optional missing data and dropout rates.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `n` | Number of subjects (1-999) | 100 |
| `visits` | Number of visits including baseline | 3 |
| `arms` | Vector of treatment arms | `c('Placebo', 'Treatment')` |
| `dropout_rate` | Proportion of subjects who dropout (0-1) | 0 |
| `na_rate` | Proportion of values missing at random (0-1) | 0 |
| `seed` | Random seed for reproducibility | `NULL` |

##### Examples

```{r}
# Basic dataset
clinical_df <- clinical_data()

head(clinical_df)

tail(clinical_df)
```
```{r}
# Multiple treatment arms
clinical_df <- clinical_data(arms = c('A', 'B', 'C'))

head(clinical_df)

tail(clinical_df)
```
```{r}
# 20% of subjects drop out and 5% of values missing at random
clinical_df <- clinical_data(dropout_rate = 0.2, na_rate = 0.05)

head(clinical_df)

tail(clinical_df)
```

#### **summary_table()**

##### Description

Generates summary tables for biostatistics and clinical data analysis with automatic statistical test selection and effect size calculations. Handles both numeric and categorical variables, performing appropriate descriptive statistics and inferential tests for single-group summaries or two-group comparisons.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `data` | A data frame containing the variables to be summarized | `Required` |
| `group_var` | Name of the grouping variable for two-group comparisons | `NULL` |
| `all_stats` | Logical; if TRUE, provides detailed statistical summary | `FALSE` |
| `effect_size` | Logical; if TRUE, includes effect size estimates | `FALSE` |
| `exclude` | Character vector; variable names to exclude from the summary | `NULL` |

##### Examples

```{r}
clinical_df <- clinical_data()

# General summary without considering treatment groups
clinical_summary <- summary_table(clinical_df,
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```
    
```{r}
# Grouped summary for each tratment group
clinical_summary <- summary_table(clinical_df,
                                  group_var = 'treatment',
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```
    
```{r}
# Grouped summary for each tratment group with all stats
clinical_summary <- summary_table(clinical_df,
                                  group_var = 'treatment',
                                  all_stats = TRUE,
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```
    
```{r}
# Grouped summary for each tratment group with effect size
clinical_summary <- summary_table(clinical_df,
                                  group_var = 'treatment',
                                  effect_size = TRUE,
                                  exclude = c('subject_id', 'visit'))
```

```{r, echo=FALSE, results='asis'}
knitr::kable(clinical_summary, format = "markdown")
```

#### **normality()**

##### Description

Tests normality with statistical tests and visual assessment using QQ plot and histogram.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `x` | A numeric vector or the name of a variable in a data frame | `Required` |
| `data` | Optional data frame containing the variable | `NULL` |
| `outliers` | Logical; whether to print all outlier row numbers | `FALSE` |
| `color` | Character; color for points and histogram bars | `"#7fcdbb"` |

##### Examples

```{r, fig.width=10, fig.height=5, dpi=300, out.width="100%"}
# Normal data
normality('biomarker',
          data = clinical_df)
```

```{r, fig.width=10, fig.height=5, dpi=300, out.width="100%"}
# Skewed data (show rows of outliers)
normality('weight',
          data = clinical_df,
          outliers = TRUE)
```

#### **missing_values()**

##### Description

Analyzes missing values in a dataframe, providing counts and percentages per
column with visualizations.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `df` | A dataframe to analyze for missing values | `Required` |
| `color` | Character; color for missing values | `"#7fcdbb"` |
| `max_heatmap_rows` | Integer; maximum number of rows to show in heatmap | `200` |

##### Examples

```{r, fig.width=10, fig.height=5, dpi=300, out.width="100%"}
# Genrate simulated clinical data with subject dropout and missing values
clinical_df <- clinical_data(dropout_rate = 0.1, na_rate = 0.1)

missing_values(clinical_df)
```

### Sample Size and Power Calculation

#### **sample_size()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **sample_size_table()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **stat_power()**

##### Description

...

##### Parameters

...

##### Examples

...

### Statistical Tests

#### **odds()**

##### Description

Calculates odds ratio and risk ratio from a 2x2 contingency table.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `a` | Number of exposed individuals with the outcome | `Required` |
| `b` | Number of exposed individuals without the outcome | `Required` |
| `c` | Number of unexposed individuals with the outcome | `Required` |
| `d` | Number of unexposed individuals without the outcome | `Required` |
| `conf.level` | Confidence level for intervals | `0.95` |

##### Examples

```{r}
odds(15, 85, 5, 95)
```

#### **anova_test()**

##### Description

Performs one-way ANOVA and conditional post-hoc comparisons.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `formula` | Formula specifying response ~ group (e.g., value ~ treatment) | `Required` |
| `data` | Data frame containing the variables | `Required` |
| `alpha` | Significance level for ANOVA test | `0.05` |
| `method` | Post-hoc method: "tukey", "bonferroni", or "holm" | `"tukey"` |
| `na.action` | How to handle missing values | `na.omit` |

##### Examples

```{r}
# Simulated clinical data with three treatment arms
clinical_df <- clinical_data(n = 300, arms = c('A', 'B', 'C', 'D'))

# Basic ANOVA
anova_test(biomarker ~ treatment, data = clinical_df)
```
```{r}
# With Bonferroni correction
anova_test(biomarker ~ treatment, data = clinical_df, method = "bonferroni")
```

#### **hypothesis_test()**

##### Description

...

##### Parameters

...

##### Examples

...

### Data Cleaning and Transformation

#### **outliers()**

##### Description

Identifies outliers using Tukey's method (IQR) and provides visual assessment.

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `x` | A numeric vector or the name of a variable in a data frame | `Required` |
| `data` | Optional data frame containing the variable | `NULL` |
| `threshold` | Numeric; multiplier of IQR for outlier detection | `1.5` |
| `color` | Character; color for visualization elements | `"#7fcdbb"` |

##### Examples

```{r, fig.width=10, fig.height=5, dpi=300, out.width="100%"}
# Simulated clinical data
clinical_df <- clinical_data()

outliers(clinical_df$biomarker)
```

#### **from_baseline()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **auc()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **impute()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **pivot_data()**

##### Description

Converts clinical trial data between long format (multiple rows per subject) and
wide format (multiple columns per timepoint).

##### Parameters

| Parameter | Description | Default |
|-----------|-------------|---------|
| `data` | Data frame containing clinical data | `Required` |
| `direction` | Character; "wide" for long-to-wide or "long" for wide-to-long | `Required` |
| `id_var` | Character; variable that identifies each subject | `Required` |
| `time_var` | Character; name of time/visit variable | `Required` |
| `value_vars` | Character vector; variables to pivot | `all except id_var and time_var` |

##### Examples

```{r}
clinical_df <- clinical_data()
str(clinical_df)
```
```{r}
# Long to wide format
wide_data <- pivot_data(clinical_df, "wide", "subject_id", "visit")
str(wide_data)
```
```{r}
# Wide to long format
long_data <- pivot_data(wide_data, "long", "subject_id", "visit")
str(long_data)
```

### Data Visualization

#### **plot_bar()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_hist()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_box()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_line()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_waterfall()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_spider()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_sankey()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_butterfly()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_auc()**

##### Description

...

##### Parameters

...

##### Examples

...

#### **plot_correlation()**

##### Description

...

##### Parameters

...

##### Examples

...
